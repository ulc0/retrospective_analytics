"WITH timestamps AS (\n  SELECT DISTINCT window \n  FROM `edav_dev_cdh_test`.`dev_cdh_ml_test`.`ml_fs_patbill_profile_metrics`\n  WHERE log_type=\"INPUT\"), \ngranularities AS (\n  SELECT DISTINCT granularity \n  FROM `edav_dev_cdh_test`.`dev_cdh_ml_test`.`ml_fs_patbill_profile_metrics`\n  WHERE log_type=\"INPUT\"),\nbaseline_metrics AS (\n  SELECT b.window, c.granularity, a.* EXCEPT(a.window, a.granularity) \n  FROM `edav_dev_cdh_test`.`dev_cdh_ml_test`.`ml_fs_patbill_profile_metrics` AS a, timestamps AS b, granularities AS c \n  WHERE a.log_type=\"BASELINE\"\n),\nnumeric_columns AS (\n  SELECT DISTINCT column_name\n  FROM `edav_dev_cdh_test`.`dev_cdh_ml_test`.`ml_fs_patbill_profile_metrics`\n  WHERE quantiles IS NOT NULL\n)\nSELECT CAST(\n  CASE \"{{Metric}}\"\n    WHEN \"Average\" THEN avg\n    WHEN \"Std Deviation\" THEN stddev\n    WHEN \"Count of 0s\" THEN num_zeros\n    WHEN \"Count of NULL\" THEN num_nulls\n    WHEN \"Count of NaN\" THEN num_nan\n    WHEN \"Percent of NaN\" THEN percent_nan\n    WHEN \"Count\" THEN count\n    WHEN \"Count distinct\" THEN distinct_count\n    WHEN \"Percent distinct\" THEN percent_distinct\n    WHEN \"Median\" THEN median\n    WHEN \"Max\" THEN max\n    WHEN \"Percent of NULL\" THEN percent_null\n    WHEN \"Min\" THEN min\n    WHEN \"Percent of 0s\" THEN percent_zeros\n    ELSE NULL\n  END AS DOUBLE) AS metric, \n  window.start AS Window,\n  IF(log_type = \"BASELINE\", \"Baseline\", \"Input\") AS readable_log_type,\n  column_name,\n  granularity AS Granularity,\n  COALESCE(slice_key, \"No slice\") AS `Slice key`,\n  COALESCE(slice_value, \"No slice\") AS `Slice value`\nFROM (\n  (SELECT window, granularity, * EXCEPT (window, granularity) FROM `edav_dev_cdh_test`.`dev_cdh_ml_test`.`ml_fs_patbill_profile_metrics` WHERE log_type=\"INPUT\") \n  UNION ALL\n  (SELECT * FROM baseline_metrics)\n)\nWHERE (log_type = \"INPUT\" OR UCASE(log_type) = UCASE(\"{{Compare to}}\")) \n  AND window.start >= \"{{ Time range.start }}\" AND window.start <= \"{{ Time range.end }}\" \n  AND column_name IN (SELECT * from numeric_columns)\n  AND column_name = {{ Column }}"